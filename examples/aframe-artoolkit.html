<!DOCTYPE html>
<!-- include a-frame -->
<script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>
<!-- include aframe-artoolkit -->
<script src="../build/aframe-artoolkit.js"></script>
<!-- include minecraft -->
<script src='vendor/threex.minecraft/a-frame/build/aframe-minecraft.min.js'></script>
<script>THREEx.MinecraftChar.baseUrl = 'vendor/threex.minecraft/'</script>

<body style='margin: 0px'>
	<div style='width:640px; height:480px;' id='aframe-container'></div>
	<!-- domElement UI -->
	<style>
	body {
		font-family: Monospace;
	}
	#demoUITop {
		position: absolute;
		top: 0;
		left: 0;
		background-color: rgba(255,255,255,0.4);
		padding: 10px;
	}
	#demoUIBottom {
		position: absolute;
		bottom: 0;
		left: 0;
		background-color: rgba(255,255,255,0.4);
		padding: 10px;
	}
	.rs-base {	/* the aframe stat */
		left : auto;
		right: 20px;
	}
	</style>
	<div id='demoUITop'>
		<label>Video Source :
			<select id='videoSource'>
			  <option value="webcam">webcam</option> 
			  <option value="video_headtracking">video_headtracking</option>
			  <option value="video_output_4">video_output_4</option>
			  <option value="image_armchair">image_armchair</option>
			</select>
		</label>
		<br/>
		<label>Marker Content :
			<select id='markerContent'>
			  <option value="cube">cube</option> 
			  <option value="minecraft">minecraft</option>
			</select>
		</label>
	</div>		
	<div id='demoUIBottom'>
		<label>Marker Type :
			<select id='markerType'>
			  <option value="hiro">hiro</option> 
			  <option value="kanji">kanji</option>
			  <option value="unknown">unknown</option>
			  <option value="barcode_3x3_20">barcode_3x3_20</option>
			</select>
		</label>
		<br/>
		<label>debug :
			<select id='debug'>
			  <option value="true">true</option> 
			  <option value="false">false</option>
			</select>
		</label>
		<br/>
		<label>detectionMode :
			<select id='detectionMode'>
			  <option value="color">color</option> 
			  <option value="color_and_matrix">color_and_matrix</option> 
			  <option value="mono">mono</option> 
			  <option value="mono_and_matrix">mono_and_matrix</option> 
			</select>
		</label>
		<br/>
		<label>matrixCodeType :
			<select id='matrixCodeType'>
			  <option value="3x3">3x3</option> 
			  <option value="3x3_HAMMING63">3x3_HAMMING63</option> 
			  <option value="3x3_PARITY65">3x3_PARITY65</option> 
			  <option value="4x4">4x4</option> 
			  <option value="4x4_BCH_13_9_3">4x4_BCH_13_9_3</option> 
			  <option value="4x4_BCH_13_5_5">4x4_BCH_13_5_5</option> 
			</select>
		</label>
	</div>
	<script>
		// define options with default values
		var options = {
			videoSource : 'webcam',
			markerType : 'hiro',
			markerContent : 'cube',
			debug : 'true',
			detectionMode : 'color_and_matrix',
			matrixCodeType: '3x3'
		}
		// get options from the url
		parseUrlOptions()
		function parseUrlOptions(){
			var optionsString = location.hash.substring(1)
			if( optionsString.length === 0 ) return options
			optionsString.split('&').forEach(function(variable){
				var tokens = variable.split('=')
				var name = tokens[0]
				var value = tokens[1]
				options[name] = value
			})
		}
		// update UI
		// debugger
		document.body.querySelector('#videoSource').value = options.videoSource
		document.body.querySelector('#markerType').value = options.markerType
		document.body.querySelector('#markerContent').value = options.markerContent
		document.body.querySelector('#debug').value = options.debug
		document.body.querySelector('#detectionMode').value = options.detectionMode
		document.body.querySelector('#matrixCodeType').value = options.matrixCodeType
		// react when UI is changed
		document.body.querySelector('#videoSource').addEventListener('change', onChange)
		document.body.querySelector('#markerType').addEventListener('change', onChange)
		document.body.querySelector('#markerContent').addEventListener('change', onChange)
		document.body.querySelector('#debug').addEventListener('change', onChange)
		document.body.querySelector('#detectionMode').addEventListener('change', onChange)
		document.body.querySelector('#matrixCodeType').addEventListener('change', onChange)
		function onChange(){
			var optionsString = ''
			// videoSource
			var videoSource = document.body.querySelector('#videoSource').value
			if( optionsString.length > 0 )	optionsString += '&'
			optionsString += 'videoSource='+videoSource
			// markerType
			var markerType = document.body.querySelector('#markerType').value
			if( optionsString.length > 0 )	optionsString += '&'
			optionsString += 'markerType='+markerType
			// markerContent
			var markerContent = document.body.querySelector('#markerContent').value
			if( optionsString.length > 0 )	optionsString += '&'
			optionsString += 'markerContent='+markerContent
			// debug
			var debug = document.body.querySelector('#debug').value
			if( optionsString.length > 0 )	optionsString += '&'
			optionsString += 'debug='+debug
			// detectionMode
			var detectionMode = document.body.querySelector('#detectionMode').value
			if( optionsString.length > 0 )	optionsString += '&'
			optionsString += 'detectionMode='+detectionMode
			// matrixCodeType
			var matrixCodeType = document.body.querySelector('#matrixCodeType').value
			if( optionsString.length > 0 )	optionsString += '&'
			optionsString += 'matrixCodeType='+matrixCodeType
			
			// change the window.location
			window.location.hash = '#'+optionsString
			window.location.reload()
		}

		// init scene based on options
		var sceneHtml = ''
		sceneHtml += "<a-scene stats embedded artoolkit='"
		// honor options.detectionMode
		sceneHtml += "detectionMode: "+options.detectionMode+';'
		// honor options.matrixCodeType
		sceneHtml += "matrixCodeType: "+options.matrixCodeType+';'
		// honor options.videoSource
		if( options.videoSource === 'webcam' )			sceneHtml += " sourceType: webcam;"
		if( options.videoSource === 'video_headtracking' )	sceneHtml += " sourceType: video; sourceUrl:./videos/headtracking.mp4;"
		if( options.videoSource === 'video_output_4' )		sceneHtml += " sourceType: video; sourceUrl:./videos/output_4.mp4;"
		if( options.videoSource === 'image_armchair' )		sceneHtml += " sourceType: image; sourceUrl:./images/armchair.jpg;"

		// honor options.debug
		if( options.debug === 'true' )	sceneHtml += " debug: true"
		if( options.debug === 'false' )	sceneHtml += " debug: false"

		// complete <a-scene> beggining tag
		sceneHtml += "'>"

		// honor options.markerType
		if( options.markerType === 'unknown' )	sceneHtml += "<a-marker type='unknown'>"
		if( options.markerType === 'hiro' )	sceneHtml += "<a-marker type='pattern' url='data/patt.hiro'>"
		if( options.markerType === 'kanji' )	sceneHtml += "<a-marker type='pattern' url='data/patt.kanji'>"
		if( options.markerType === 'barcode_3x3_20' )	sceneHtml += "<a-marker type='barcode' value=20>"
			  
		// honor options.markerContent
		if( options.markerContent === 'cube' ){
			sceneHtml += `<a-box depth="1" height="1" width="1" position='0 0 0.5' material='opacity: 0.5; side:double'></a-box>
			<a-entity geometry="primitive: torusKnot; radius: 0.3; radiusTubular: 0.05" position='0 0 0.5'>
				<a-animation attribute="rotation" from="0 0 0" to="360 0 0" dur="5000" easing='linear' repeat="indefinite"></a-animation>
			</a-entity>`			
		}
		if( options.markerContent === 'minecraft' ){
			sceneHtml += `<a-minecraft rotation="90 0 0"></a-minecraft>`			
		}
		
		// add the remaining to close the scene
		sceneHtml+= `</a-marker>
			<a-entity camera></a-entity>
		</a-scene>`

		document.body.querySelector('#aframe-container').innerHTML = sceneHtml
	
	</script>
</body>
</html>
